<!DOCTYPE html>
<html>
	<head>
		<script src="scripts/jquery-3.2.1.min.js"></script>
		<script>
	$(document).ready(
			function() {
				$.ajax({
					url : "http://localhost:8082/fanZone/getRekviziti"
				}).then(
						function(data) {
							for (i = 0; i < data.length; i++) {
								newRow = 
									"<tr>"
										+ "<td class=\"picture\">" + data[i].slika + "</td>"
										+ "<td class=\"name\">" + data[i].ime + "</td>"
										+ "<td class=\"price\">" + data[i].cena + "</td>"
										+ "<td class=\"description\">" + data[i].opis + "</td>"
										+ "<td><a class=\"remove\" href='/fanZone/" + data[i].id + "'>" 
										+ "Obrisi</a></td>"
										+ "<td><a class=\"edit\" href='/fanZone/get/" + data[i].id + "'>" 
										+ "Izmeni</a></td>"
									+ "</tr>"
								$("#dataTable").append(newRow)
							}
						});
				$("#add").click(function(){
					//pripremamo JSON koji cemo poslati
					formData = JSON.stringify({
    	                slika:$("#inputForm [name='picture']").val(),
    	                ime:$("#inputForm [name='name']").val(),
    	                cena:$("#inputForm [name='price']").val(),
    	               	opis:$("#inputForm [name='description']").val(),
    	            });
					$.ajax({
						url: "http://localhost:8082/fanZone/dodaj",
						type: "POST",
						data: formData,
						contentType: "application/json",
						datatype: 'json',
						success: function(data) {
							newRow = 
									"<tr>"
										+ "<td class=\"picture\">" + data.slika + "</td>"
										+ "<td class=\"name\">" + data.ime + "</td>"
										+ "<td class=\"price\">" + data.cena + "</td>"
										+ "<td class=\"description\">" + data.opis + "</td>"
										+ "<td><a class=\"remove\" href='/fanZone/" + data.id + "'>" 
										+ "Obrisi</a></td>"
										+ "<td><a class=\"edit\" href='/fanZone/get/" + data.id + "'>" 
										+ "Izmeni</a></td>"
										+ "</tr>"
							$("#dataTable").append(newRow)
						  },
						  error: function(data){
							  alert('Nevalidan unos')
						  }
						});
					
				});
				$(document).on("click", ".remove", function(event){
					//ne salji get zahtev
					event.preventDefault(); 
					
					var confirmed = confirm("Da li ste sigurni da zelite da obrišete?");
					if(confirmed){
					
						var url = $(this).attr("href")
						//red koji se treba izbrisati ako je brisanje na serveru bilo uspesno
						tr_parent = $(this).closest("tr")
						$.ajax({
				        	url: url,
				        	type: "DELETE",
				        	success: function(){
				        		//ukloni i na strani 
								tr_parent.remove()
					        }
						});
					}
				});
				
				$(document).on("click", ".edit", function(event){
					
					event.preventDefault(); 
					var url = $(this).attr("href")
					tr_parent = $(this).closest("tr")
					
					$.ajax({
						url: url,
						type: "GET",
						contentType: "application/json",
						datatype: 'json',
						success: function(data){
							index = $("tr").index(tr_parent)+1
							item = $("tr:nth-child(" + index + ")");
							sync(item);
						}
					});
					
				});
				
			});
	//funkcija ciji je cilj da napuni sadrzaj edit polja
	function sync(item){
		slika = item.find(".picture").html()
	    ime = item.find(".name").html()
	    cena = item.find(".price").html()
	    opis = item.find(".description").html()
	    $("#slika").val(slika);
	    $("#ime").val(ime);
	    $("#cena").val(cena);
	    $("#opis").val(opis);
	}	
</script>
		<title>Zvanicna prodavnica</title>
	</head>
	<body>
		<h1>Zvanicna prodavnica</h1>
		<table border = "1" id = "dataTable">
			<tr>
				<th>Slika</th>
				<th>Ime</th>
				<th>Cena</th>
				<th>Opis artikla</th>
				<th></th>
			</tr>
		</table>
		      <form id="inputForm">
					<input type="hidden" name="id" id="id" />
				<p>
					<label for="slika">Slika</label> <input type="text" name="picture"
						id="slika" />
				</p>
				<p>
					<label for="ime">Ime</label> <input type="text" name="name"
						id="ime" />
				</p>
				<p>
					<label for="cena">Cena</label> <input type="text" name="price"
						id="cena" />
				</p>
				<p>
					<label for="opis">Opis</label> <input type="text" name="description"
						id="opis" />
				</p>		
		        <button type="button" class="btn btn-primary" id="add">Potvrda</button>
		      </form>
	</body>
</html>